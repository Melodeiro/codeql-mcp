# üéØ –ü–ª–∞–Ω –£–ª—É—á—à–µ–Ω–∏–π CodeQL MCP Server

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è
- Windows compatibility (temp paths)
- Security (argument injection)
- Blocking operations –≤ async functions
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ timeouts –≤ subprocess calls

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (Priority: HIGH)

### 1. Windows Temp Paths (15 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: `/tmp/` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ Windows  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: `Path("/tmp")` ‚Üí `\tmp` (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É –¥–∏—Å–∫—É)

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `server.py` (—Å—Ç—Ä–æ–∫–∏ 60, 87, 112, 118, 282, 339)

#### –†–µ—à–µ–Ω–∏–µ:

**–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ `server.py`:**
```python
import tempfile
from pathlib import Path

# Cross-platform temp directory for CodeQL MCP
TEMP_DIR = Path(tempfile.gettempdir()) / "codeql-mcp"
TEMP_DIR.mkdir(parents=True, exist_ok=True)
```

**–ò–∑–º–µ–Ω–∏—Ç—å default –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
# –ë–´–õ–û:
async def test_predicate(
    file: str, db: str, symbol: str, output_path: str = "/tmp/quickeval.bqrs"
) -> str:

# –°–¢–ê–õ–û:
async def test_predicate(
    file: str, db: str, symbol: str, output_path: str = str(TEMP_DIR / "quickeval.bqrs")
) -> str:
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è:**
- `evaluate_query`: `"/tmp/eval.bqrs"` ‚Üí `str(TEMP_DIR / "eval.bqrs")`
- `analyze_database`: `"/tmp/analysis"` ‚Üí `str(TEMP_DIR / "analysis")`
- `run_security_scan`: `"/tmp/security-scan"` ‚Üí `str(TEMP_DIR / "security-scan")`

**–¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
```bash
python -c "from pathlib import Path; import tempfile; TEMP_DIR = Path(tempfile.gettempdir()) / 'codeql-mcp'; TEMP_DIR.mkdir(exist_ok=True); print(TEMP_DIR)"
```

---

### 2. Argument Injection Protection (15 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: Language parameter –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è ‚Üí argument injection  
**–ò—Å—Ç–æ—á–Ω–∏–∫**: OWASP Command Injection Defense

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `tools/database.py`
- `tools/discovery.py`

#### –†–µ—à–µ–Ω–∏–µ:

**–í `tools/database.py` (–¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞):**
```python
# Whitelist of supported languages (based on CodeQL documentation)
ALLOWED_LANGUAGES = frozenset({
    "python", "javascript", "typescript", "java", "kotlin",
    "cpp", "c", "csharp", "go", "ruby", "swift"
})
```

**–ò–∑–º–µ–Ω–∏—Ç—å `create_database_impl` (—Å—Ç—Ä–æ–∫–∞ 41-67):**
```python
def create_database_impl(qs, source_path: str, language: str, db_path: str,
                         command: str = None, overwrite: bool = False) -> str:
    """Implementation for create_database tool"""
    
    # Validate language against whitelist to prevent argument injection
    if language not in ALLOWED_LANGUAGES:
        return (
            f"Invalid language: {language!r}. "
            f"Allowed languages: {', '.join(sorted(ALLOWED_LANGUAGES))}"
        )
    
    try:
        # Build the command
        cmd = [qs.codeql_path, "database", "create", db_path, f"--language={language}"]
        # ... rest of function
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤ `tools/discovery.py` (—Å—Ç—Ä–æ–∫–∞ 95-156):**
```python
# –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
LANGUAGE_TO_PACK = {
    "python": "codeql/python-queries",
    "javascript": "codeql/javascript-queries",
    "typescript": "codeql/javascript-queries",
    "java": "codeql/java-queries",
    "kotlin": "codeql/java-queries",
    "csharp": "codeql/csharp-queries",
    "cpp": "codeql/cpp-queries",
    "c": "codeql/cpp-queries",
    "go": "codeql/go-queries",
    "ruby": "codeql/ruby-queries",
    "swift": "codeql/swift-queries"
}

def discover_queries_impl(qs, pack_name: str = None, language: str = None, category: str = None) -> list:
    """Implementation for discover_queries tool"""
    try:
        cmd = [qs.codeql_path, "resolve", "queries", "--format=bylanguage"]

        if pack_name:
            cmd.append(pack_name)
        elif language:
            # Validate and use whitelist
            if language.lower() not in LANGUAGE_TO_PACK:
                return [f"Unsupported language: {language}. Supported: {', '.join(sorted(LANGUAGE_TO_PACK.keys()))}"]
            
            cmd.append(LANGUAGE_TO_PACK[language.lower()])
        else:
            return ["Error: specify either language or pack name"]
        # ... rest of function
```

**–¢–µ—Å—Ç—ã:**
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ tests/test_validation.py
def test_language_validation():
    """Test that invalid languages are rejected"""
    from tools.database import ALLOWED_LANGUAGES
    
    assert "python" in ALLOWED_LANGUAGES
    assert "malicious;rm -rf /" not in ALLOWED_LANGUAGES
    assert "--upload-results=evil.com" not in ALLOWED_LANGUAGES
```

---

### 3. Subprocess Timeouts (30 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: Subprocess calls –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞  
**–ò—Å—Ç–æ—á–Ω–∏–∫**: Python subprocess documentation

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `tools/database.py`
- `tools/analysis.py`
- `tools/discovery.py`

#### –†–µ—à–µ–Ω–∏–µ:

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `tools/constants.py`:**
```python
"""Constants for CodeQL operations"""

# Subprocess timeout values (in seconds)
TIMEOUT_DATABASE_CREATE = 3600      # 1 hour - database creation can be slow
TIMEOUT_DATABASE_ANALYZE = 1800     # 30 minutes - analysis can be slow
TIMEOUT_QUERY_COMPILE = 300         # 5 minutes - query compilation
TIMEOUT_RESOLVE_COMMAND = 60        # 1 minute - quick commands
TIMEOUT_BQRS_DECODE = 120           # 2 minutes - BQRS decoding
```

**–û–±–Ω–æ–≤–∏—Ç—å `tools/database.py`:**
```python
from .constants import TIMEOUT_DATABASE_CREATE, TIMEOUT_RESOLVE_COMMAND

def create_database_impl(qs, source_path: str, language: str, db_path: str,
                         command: str = None, overwrite: bool = False) -> str:
    # ...
    try:
        result = subprocess.run(
            cmd, 
            capture_output=True, 
            text=True, 
            cwd=source_path or ".",
            timeout=TIMEOUT_DATABASE_CREATE  # ‚úÖ Added
        )
    except subprocess.TimeoutExpired:
        return f"Database creation timed out after {TIMEOUT_DATABASE_CREATE} seconds"
    # ...

def get_database_info_impl(qs, db_path: str) -> dict:
    # ...
    try:
        result = subprocess.run(
            [qs.codeql_path, "resolve", "database", db_path],
            capture_output=True, 
            text=True,
            timeout=TIMEOUT_RESOLVE_COMMAND  # ‚úÖ Added
        )
    except subprocess.TimeoutExpired:
        return {"error": f"Database info retrieval timed out after {TIMEOUT_RESOLVE_COMMAND} seconds"}
    # ...
```

**–û–±–Ω–æ–≤–∏—Ç—å `tools/analysis.py`:**
```python
from .constants import TIMEOUT_DATABASE_ANALYZE

def analyze_database_impl(qs, db_path: str, query_or_suite: str, output_format: str = "sarif-latest",
                          output_path: str = "/tmp/analysis") -> str:
    # ...
    try:
        result = subprocess.run(
            cmd, 
            capture_output=True, 
            text=True,
            timeout=TIMEOUT_DATABASE_ANALYZE  # ‚úÖ Added
        )
    except subprocess.TimeoutExpired:
        return f"Analysis timed out after {TIMEOUT_DATABASE_ANALYZE} seconds"
    # ...
```

**–û–±–Ω–æ–≤–∏—Ç—å `tools/discovery.py`:**
```python
from .constants import TIMEOUT_RESOLVE_COMMAND

def list_supported_languages_impl(qs) -> list:
    try:
        result = subprocess.run(
            [qs.codeql_path, "resolve", "languages"],
            capture_output=True, 
            text=True,
            timeout=TIMEOUT_RESOLVE_COMMAND  # ‚úÖ Added
        )
    except subprocess.TimeoutExpired:
        return [f"Error: Language resolution timed out after {TIMEOUT_RESOLVE_COMMAND} seconds"]
    # ...
```

**–û–±–Ω–æ–≤–∏—Ç—å `codeqlclient.py`:**
```python
def decode_bqrs(self, bqrs_path, output_format="json"):
    # ...
    try:
        result = subprocess.run(
            [self.codeql_path, "bqrs", "decode", "--format", output_format, bqrs_path],
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
            timeout=120  # 2 minutes for BQRS decoding
        )
    except subprocess.TimeoutExpired:
        raise RuntimeError(f"BQRS decoding timed out after 120 seconds")
    # ...
```

---

## üü° –í–ê–ñ–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (Priority: MEDIUM)

### 5. Async Subprocess Calls (1-2 —á–∞—Å–∞)

**–ü—Ä–æ–±–ª–µ–º–∞**: Blocking subprocess.run() –≤ async functions –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop  
**–ò—Å—Ç–æ—á–Ω–∏–∫**: Python asyncio documentation - asyncio.to_thread()

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `tools/discovery.py`
- `tools/database.py`
- `tools/analysis.py`

#### –†–µ—à–µ–Ω–∏–µ:

**–û–±–Ω–æ–≤–∏—Ç—å `tools/discovery.py`:**
```python
import asyncio
from .constants import TIMEOUT_RESOLVE_COMMAND

async def list_supported_languages_impl(qs: 'CodeQLQueryServer') -> list[str]:
    """Implementation for list_supported_languages tool"""
    try:
        result = await asyncio.to_thread(
            subprocess.run,
            [qs.codeql_path, "resolve", "languages"],
            capture_output=True,
            text=True,
            timeout=TIMEOUT_RESOLVE_COMMAND
        )
        
        if result.returncode != 0:
            return [f"Error getting languages: {result.stderr}"]
        
        # Parse the output to extract language names
        languages = []
        for line in result.stdout.strip().split('\n'):
            if line.strip():
                lang = line.strip().split()[0] if line.strip().split() else line.strip()
                languages.append(lang)
        
        return languages
    except subprocess.TimeoutExpired:
        return [f"Error: Language resolution timed out after {TIMEOUT_RESOLVE_COMMAND} seconds"]
    except Exception as e:
        return [f"Error: {str(e)}"]
```

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –≤—Å–µ—Ö subprocess.run() –≤ async —Ñ—É–Ω–∫—Ü–∏—è—Ö.**

**–í–ê–ñ–ù–û**: –ò–∑–º–µ–Ω–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –≤ `tools/__init__.py`:
```python
# –ë–´–õ–û (sync):
from .discovery import list_supported_languages_impl

# –°–¢–ê–õ–û (async):
# –°–∏–≥–Ω–∞—Ç—É—Ä—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ –≤ __init__.py, –Ω–æ –≤ server.py –±—É–¥–µ—Ç await
```

**–û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã –≤ `server.py`:**
```python
# –ë–´–õ–û:
@mcp.tool()
async def list_supported_languages() -> list:
    return list_supported_languages_impl(qs)

# –°–¢–ê–õ–û:
@mcp.tool()
async def list_supported_languages() -> list:
    return await list_supported_languages_impl(qs)
```

---

### 6. Thread-Safe Cache —Å lru_cache (30 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: Global dict –Ω–µ thread-safe –≤ free-threading Python 3.13+  
**–ò—Å—Ç–æ—á–Ω–∏–∫**: Python functools.lru_cache documentation

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `tools/database.py`

#### –†–µ—à–µ–Ω–∏–µ:

**–ó–∞–º–µ–Ω–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π cache –Ω–∞ lru_cache:**
```python
"""Database operations: creation, registration, and metadata retrieval"""

import subprocess
import logging
from pathlib import Path
from functools import lru_cache
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from codeqlclient import CodeQLQueryServer

logger = logging.getLogger(__name__)
logger.addHandler(logging.NullHandler())

# –£–î–ê–õ–ò–¢–¨:
# db_info_cache = {}


@lru_cache(maxsize=128)
def _get_db_info_cached(codeql_path: str, db_path_str: str) -> dict[str, str | int]:
    """
    Cached database info retrieval using only hashable parameters.
    
    This is separated from get_database_info_impl to work with lru_cache,
    which requires all arguments to be hashable.
    """
    from .constants import TIMEOUT_RESOLVE_COMMAND
    
    try:
        # Use official codeql resolve database command
        result = subprocess.run(
            [codeql_path, "resolve", "database", db_path_str],
            capture_output=True,
            text=True,
            timeout=TIMEOUT_RESOLVE_COMMAND
        )

        if result.returncode != 0:
            return {"error": f"Failed to get database info: {result.stderr}"}

        # Parse JSON output from codeql resolve database
        import json
        db_data = json.loads(result.stdout)
        
        # Extract language from languages array
        language = None
        if "languages" in db_data and isinstance(db_data["languages"], list):
            language = db_data["languages"][0] if db_data["languages"] else None
        
        info = {
            "path": db_path_str,
            "language": language
        }

        # Get baseline info for statistics
        baseline_result = subprocess.run(
            [codeql_path, "database", "print-baseline", "--", db_path_str],
            capture_output=True,
            text=True,
            timeout=TIMEOUT_RESOLVE_COMMAND
        )

        if baseline_result.returncode == 0:
            import re
            for line in baseline_result.stdout.split('\n'):
                if 'baseline of' in line and 'lines' in line:
                    numbers = re.findall(r'\d+', line)
                    if numbers:
                        info['lines_of_code'] = int(numbers[0])

        return info

    except subprocess.TimeoutExpired:
        return {"error": f"Database info retrieval timed out after {TIMEOUT_RESOLVE_COMMAND} seconds"}
    except Exception as e:
        return {"error": f"Error getting database info: {str(e)}"}


def get_database_info_impl(qs: 'CodeQLQueryServer', db_path: str) -> dict[str, str | int]:
    """Implementation for get_database_info tool"""
    db_path_str = str(Path(db_path).resolve())
    return _get_db_info_cached(qs.codeql_path, db_path_str)
```

**–û–±–Ω–æ–≤–∏—Ç—å fixture –≤ `tests/conftest.py`:**
```python
@pytest.fixture(autouse=True)
def reset_cache():
    """Reset global caches before each test for proper isolation"""
    from tools.database import _get_db_info_cached
    _get_db_info_cached.cache_clear()  # ‚úÖ lru_cache method
    yield
```

---

## üü¢ –ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (Priority: LOW)

### 5. Ruff Linting (15 –º–∏–Ω—É—Ç)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –ª–∏–Ω—Ç–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∏–ª—è –∫–æ–¥–∞

#### –†–µ—à–µ–Ω–∏–µ:

```bash
uv add --dev ruff

# –°–æ–∑–¥–∞—Ç—å ruff.toml
cat > ruff.toml << 'EOF'
target-version = "py313"
line-length = 100

[lint]
select = [
    "E",   # pycodestyle errors
    "W",   # pycodestyle warnings
    "F",   # pyflakes
    "I",   # isort
    "B",   # flake8-bugbear
    "C4",  # flake8-comprehensions
    "UP",  # pyupgrade
]
ignore = [
    "E501",  # line too long (handled by formatter)
]

[lint.per-file-ignores]
"tests/*" = ["B", "F841"]  # Allow unused variables in tests
EOF

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
uv run ruff check .

# –ê–≤—Ç–æ—Ñ–∏–∫—Å
uv run ruff check --fix .
```

---

## üìù –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1 —á–∞—Å)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
git checkout -b feature/critical-improvements

# 2. Windows temp paths
# - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å server.py (–¥–æ–±–∞–≤–∏—Ç—å TEMP_DIR)
# - –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ default –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
# - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: python -c "from server import TEMP_DIR; print(TEMP_DIR)"

# 3. Argument injection protection
# - –°–æ–∑–¥–∞—Ç—å tools/constants.py —Å ALLOWED_LANGUAGES
# - –û–±–Ω–æ–≤–∏—Ç—å tools/database.py
# - –û–±–Ω–æ–≤–∏—Ç—å tools/discovery.py
# - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –≤ tests/test_validation.py

# 4. Subprocess timeouts
# - –û–±–Ω–æ–≤–∏—Ç—å tools/constants.py —Å timeout –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
# - –î–æ–±–∞–≤–∏—Ç—å timeout –≤–æ –≤—Å–µ subprocess.run()
# - –û–±–Ω–æ–≤–∏—Ç—å codeqlclient.py

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
uv run pytest -v

# 6. Commit
git add -A
git commit -m "Add critical security and compatibility improvements

- Fix Windows temp path handling using tempfile.gettempdir()
- Add argument injection protection with language whitelist
- Add subprocess timeouts to prevent hangs

Addresses: security, Windows compatibility"
```

### –≠—Ç–∞–ø 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2 —á–∞—Å–∞)

```bash
# 1. Async subprocess calls
# - –û–±–Ω–æ–≤–∏—Ç—å tools/discovery.py —Å asyncio.to_thread
# - –û–±–Ω–æ–≤–∏—Ç—å tools/database.py
# - –û–±–Ω–æ–≤–∏—Ç—å tools/analysis.py
# - –û–±–Ω–æ–≤–∏—Ç—å server.py (–¥–æ–±–∞–≤–∏—Ç—å await)

# 2. Thread-safe cache
# - –ó–∞–º–µ–Ω–∏—Ç—å global dict –Ω–∞ lru_cache –≤ tools/database.py
# - –û–±–Ω–æ–≤–∏—Ç—å tests/conftest.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
uv run pytest -v

# 4. Commit
git add -A
git commit -m "Improve async performance and thread safety

- Use asyncio.to_thread for subprocess calls in async functions
- Replace global cache with thread-safe functools.lru_cache
- Update test fixtures to work with lru_cache

Improves: performance, thread safety, free-threading compatibility"
```

### –≠—Ç–∞–ø 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (15 –º–∏–Ω—É—Ç)

```bash
# 1. Ruff linting
uv add --dev ruff
# –°–æ–∑–¥–∞—Ç—å ruff.toml
uv run ruff check --fix .

# 2. Commit
git add -A
git commit -m "Add ruff linting for code quality

- Add ruff for fast linting
- Configure ruff.toml with strict rules

Improves: code quality, developer experience"
```

### –≠—Ç–∞–ø 4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–æ–≤–µ—Ä–æ–∫
uv run pytest -v
uv run mypy server.py tools/ validation.py
uv run ruff check .

# 2. Push –∏ —Å–æ–∑–¥–∞—Ç—å PR
git push -u origin feature/critical-improvements
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: `uv run pytest -v`

- [ ] Linting —á–∏—Å—Ç: `uv run ruff check .`
- [ ] –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å temp paths)
- [ ] –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux/macOS (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å paths)

### –ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [ ] All 82+ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç ruff warnings

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ú–µ—Ç—Ä–∏–∫–∏ –î–æ ‚Üí –ü–æ—Å–ª–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **–û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞** | 8.5/10 | 9.5/10 | +1.0 |
| **Windows compatibility** | ‚ùå | ‚úÖ | Fixed |
| **Security (argument injection)** | ‚ö†Ô∏è | ‚úÖ | Fixed |
| **Async performance** | Blocking | Non-blocking | Improved |
| **Thread safety** | With GIL | Free-threading ready | Future-proof |
| **Code quality (ruff)** | N/A | Clean | Added |

### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 1 —á–∞—Å
- **–í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**: 2 —á–∞—Å–∞
- **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**: 15 –º–∏–Ω—É—Ç
- **–ò–¢–û–ì–û**: ~3.25 —á–∞—Å–∞

---

## üéì –ú–ï–¢–†–ò–ö–ò ANALYSIS

**conf**: 95% - –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (–≤—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)  
**inf**: 5% - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π inference (–ø–æ—á—Ç–∏ –≤—Å–µ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö docs)  
**adhd**: 5% - –û—á–µ–Ω—å —Ç—â–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ —Å–ø–µ—à–∫–∏

---

## üìö –ò–°–¢–û–ß–ù–ò–ö–ò

–í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

1. **FastMCP**: context7:/jlowin/fastmcp
2. **Python asyncio**: context7:/python/cpython
3. **CodeQL CLI**: context7:/github/codeql + https://docs.github.com/en/code-security/codeql-cli
4. **MCP Protocol**: https://modelcontextprotocol.io/specification/
5. **OWASP Security**: https://cheatsheetseries.owasp.org/
6. **pytest**: context7:/websites/pytest_en_stable
7. **Python typing**: Python 3.13+ documentation

---

**–°–æ–∑–¥–∞–Ω–æ**: Claude Code (Anthropic)  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —á–µ—Ä–µ–∑ docs-retriever agent  
**–í–µ—Ä—Å–∏—è –ø–ª–∞–Ω–∞**: 1.0  
**–°—Ç–∞—Ç—É—Å**: Ready for implementation
